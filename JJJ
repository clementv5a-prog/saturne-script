-- [[ FLASH HUB - DEAD SWITCH ULTIMATE (PERMANENT) ]] --
local player = game.Players.LocalPlayer
local pgui = player:WaitForChild("PlayerGui")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- --- ANTI-RESET CONFIG ---
if pgui:FindFirstChild("FlashHub") then pgui.FlashHub:Destroy() end

local ScreenGui = Instance.new("ScreenGui", pgui)
ScreenGui.Name = "FlashHub"
ScreenGui.ResetOnSpawn = false -- L'UI reste aprÃ¨s la mort

-- --- UI DESIGN ---
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 240, 0, 100)
MainFrame.Position = UDim2.new(0.05, 0, 0.4, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 15)
MainFrame.BorderSizePixel = 0
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

local UIStroke = Instance.new("UIStroke", MainFrame)
UIStroke.Thickness = 2
UIStroke.Color = Color3.fromRGB(0, 255, 255)
UIStroke.Transparency = 0.5

local Glow = Instance.new("ImageLabel", MainFrame)
Glow.BackgroundTransparency = 1
Glow.Position = UDim2.new(0, -15, 0, -15)
Glow.Size = UDim2.new(1, 30, 1, 30)
Glow.Image = "rbxassetid://5028822351"
Glow.ImageColor3 = Color3.fromRGB(0, 255, 255)
Glow.ScaleType = Enum.ScaleType.Slice
Glow.SliceCenter = Rect.new(24, 24, 276, 276)

local StatusLabel = Instance.new("TextLabel", MainFrame)
StatusLabel.Size = UDim2.new(1, 0, 0.5, 0)
StatusLabel.Position = UDim2.new(0, 0, 0.15, 0)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "STORM PROTOCOL"
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusLabel.Font = Enum.Font.Code
StatusLabel.TextSize = 20

local SubLabel = Instance.new("TextLabel", MainFrame)
SubLabel.Size = UDim2.new(1, 0, 0.3, 0)
SubLabel.Position = UDim2.new(0, 0, 0.65, 0)
SubLabel.BackgroundTransparency = 1
SubLabel.Text = "[ HOLD F ]"
SubLabel.TextColor3 = Color3.fromRGB(0, 255, 255)
SubLabel.Font = Enum.Font.Code
SubLabel.TextSize = 13

-- --- LOGIQUE CORE ---
local isHolding = false
local uuid = "d80e2217-36b8-4bdc-9a46-2281c6f70b28"
local data = string.rep("?", 8000)
local lastSafePos = nil

-- Recherche du Remote
local remote = nil
local function FindRemote()
    for _, v in ipairs(game:GetDescendants()) do
        if v:IsA("RemoteEvent") and v.Name ~= "friendmain" and v.Name ~= "ping" then
            if not v:GetFullName():lower():find("replicatedstorage") then
                return v
            end
        end
    end
end
remote = FindRemote()

-- Effets Visuels
local function ToggleUI(active)
    if active then
        TweenService:Create(Glow, TweenInfo.new(0.2), {ImageColor3 = Color3.fromRGB(255, 0, 0)}):Play()
        StatusLabel.Text = "!!! FLASHING !!!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
        task.spawn(function()
            while isHolding do
                MainFrame.Position = UDim2.new(0.05, math.random(-2,2), 0.4, math.random(-2,2))
                task.wait(0.05)
            end
            MainFrame.Position = UDim2.new(0.05, 0, 0.4, 0)
        end)
    else
        TweenService:Create(Glow, TweenInfo.new(0.2), {ImageColor3 = Color3.fromRGB(0, 255, 255)}):Play()
        StatusLabel.Text = "STORM PROTOCOL"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    end
end

-- --- INPUTS ---
UIS.InputBegan:Connect(function(i, g)
    if not g and i.KeyCode == Enum.KeyCode.F then
        isHolding = true
        ToggleUI(true)
    end
end)

UIS.InputEnded:Connect(function(i, g)
    if i.KeyCode == Enum.KeyCode.F then
        isHolding = false
        ToggleUI(false)
        
        local char = player.Character
        local root = char and char:FindFirstChild("HumanoidRootPart")
        if root then
            root.AssemblyLinearVelocity = Vector3.new(0,0,0)
            if lastSafePos then root.CFrame = lastSafePos end
        end
    end
end)

-- --- PHYSIQUE & POSITION (MULTI-CHARACTER) ---
RunService.Heartbeat:Connect(function()
    local char = player.Character
    if not char then return end
    
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    
    if isHolding and root and hum then
        if hum.MoveDirection.Magnitude > 0 then
            root.AssemblyLinearVelocity = (hum.MoveDirection * 32) + Vector3.new(0, root.AssemblyLinearVelocity.Y, 0)
            lastSafePos = root.CFrame 
        end
    end
end)

-- --- LAG LOOP ---
task.spawn(function()
    while true do
        if isHolding then
            remote = remote or FindRemote()
            if remote then
                pcall(function() remote:FireServer(uuid, data) end)
            end
            task.wait(0.01)
        else
            task.wait(0.1)
        end
    end
end)
